<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }
        .container {
            background-color: #000;
            display: flex;
            max-width: 480px;
            width: 100%;
            flex-direction: column;
            margin: 0 auto;
            box-sizing: border-box;
            height: 100vh;
            overflow-y: auto;
        }
        .section {
            border-bottom: 1px solid rgba(255, 255, 255, 0.24);
            padding: 24px 16px;
            box-sizing: border-box;
        }
        .header {
            color: #69fff1;
            font-size: 24px;
            font-family: Inter, sans-serif;
        }
        .subheader {
            color: #fff;
            margin-top: 8px;
            font-size: 16px;
            font-family: Inter, sans-serif;
        }
        .title {
            color: #fff;
            font-size: 18px;
            font-weight: 400;
            font-family: Inter, sans-serif;
        }
        .content {
            display: flex;
            margin-top: 24px;
            gap: 20px;
            flex-wrap: nowrap;
            overflow-x: auto;
        }
        .icon-container {
            display: flex;
            justify-content: center;
            border-radius: 50%;
            backdrop-filter: blur(10px);
            background-color: #fff;
            width: 40px;
            height: 40px;
            padding: 0 4px;
            cursor: pointer;
        }
        .icon {
            aspect-ratio: 7.14;
            object-fit: contain;
            object-position: center;
            width: 14px;
            fill: #000;
        }
        .number {
            color: #fff;
            text-align: center;
            font-size: 24px;
            font-weight: 500;
            font-family: Inter, sans-serif;
            min-width: 50px;
        }
        .title-container {
            display: flex;
            justify-content: space-between;
        }
        .manage-button {
            color: #69fff1;
            font-size: 14px;
            font-weight: 500;
            font-family: Inter, sans-serif;
            cursor: pointer;
        }
        .tags, .tags-group {
            display: flex;
            margin-top: 16px;
            gap: 8px;
            flex-wrap: wrap;
            overflow-x: auto;
            font-size: 14px;
            color: #fff;
            font-weight: 500;
            font-family: Inter, sans-serif;
        }
        .tag {
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.32);
            padding: 8px 12px;
            white-space: nowrap;
        }
        .tag-item {
            display: flex;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.32);
            white-space: nowrap;
        }
        .quantity {
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            background-color: #69fff1;
            color: #000;
            width: 24px;
            height: 24px;
            font-size: 12px;
            font-family: Inter, sans-serif;
        }
        .item {
            color: #fff;
            font-size: 14px;
            font-family: Inter, sans-serif;
        }
        .continue-button {
            border-radius: 50px;
            background-color: #69fff1;
            margin: 24px 16px;
            padding: 12px 0;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            font-family: Inter, sans-serif;
            cursor: pointer;
        }
        .drawer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: #fff;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
            padding: 16px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .drawer.open {
            transform: translateY(0);
        }
        @media (max-width: 480px) {
            .content {
                flex-direction: row;
                align-items: center;
            }
            .tags-group {
                flex-direction: row;
                align-items: flex-start;
            }
            .tag-item {
                justify-content: space-between;
                width: auto;
            }
            .continue-button {
                width: calc(100% - 32px);
            }
        }

        /* New Styles for Allergies Drawer */
        .allergy-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 480px;
            width: 100%;
            margin: 0 auto;
        }
        .allergy-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
        }
        .allergy-card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            border-radius: 24px 24px 0 0;
            background-color: #ffffff;
            padding: 1px 0 16px;
            align-items: center;
        }
        .allergy-card-header {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            padding: 8px 16px;
            width: 100%;
        }
        .allergy-header-title {
            font-size: 18px;
            font-weight: 600;
            color: #000000;
            margin: auto 0;
            font-family: "Inter", sans-serif;
        }
        .allergy-header-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 4px;
            border-radius: 999px;
            backdrop-filter: blur(10px);
        }
        .allergy-header-icon img {
            width: 12px;
            aspect-ratio: 1;
            object-fit: auto;
        }
        .allergy-item {
            display: flex;
            justify-content: space-between;
            padding: 17px 16px;
            gap: 10px;
            width: 80%;
        }
        .allergy-name {
            font-size: 18px;
            font-weight: 400;
            color: #000000;
            font-family: "Inter", sans-serif;
        }
        .allergy-action {
            font-size: 16px;
            font-weight: 500;
            text-align: right;
            margin: auto 0;
            font-family: "Inter", sans-serif;
            cursor: pointer;
        }
        .allergy-action.remove {
            color: #E71D36;
        }
        .allergy-submit-section {
            display: flex;
            justify-content: center;
            width: 100%;
            padding: 16px 16px 0;
        }
        .allergy-submit-button {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 17px 90px;
            border-radius: 999px;
            background-color: #000000;
            font-size: 18px;
            font-weight: 400;
            color: #FFFFFF;
            font-family: "Inter", sans-serif;
            white-space: nowrap;
            cursor: pointer;
        }

        /* New Styles for Grocery Drawers */
        .grocery-container {
                bottom: 0;
                width: 100%;
                border-radius: 24px 24px 0 0;
                background-color: #fff;
                display: flex;
                flex-direction: column;
                padding: 1px 0 16px;
                height: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
        }
        .grocery-header {
            justify-content: space-between;
            display: flex;
            padding: 8px 16px;
            width:100%
        }
        .grocery-title {
            color: #000;
            margin: auto 0;
            font: 600 18px Inter, sans-serif;
        }
        .grocery-icon-wrapper {
            justify-content: center;
            align-items: center;
            border-radius: 999px;
            backdrop-filter: blur(10px);
            display: flex;
            padding: 4px;
        }
        .grocery-icon {
            aspect-ratio: 1;
            object-fit: auto;
            object-position: center;
            width: 12px;
            fill: #000;
        }
        .grocery-item {
            justify-content: space-between;
            display: flex;
            padding: 0 16px;
            width: 80%;
        }
        .grocery-item-name {
            color: #000;
            margin: auto 0;
            font: 400 18px Inter, sans-serif;
        }
        .grocery-item-controls {
            display: flex;
            gap: 16px;
            justify-content: space-between;
            padding: 8px 0;
        }
        .control-icon-wrapper {
            justify-content: center;
            border-radius: 999px;
            backdrop-filter: blur(10px);
            display: flex;
            padding: 4px;
        }
        .control-icon {
            aspect-ratio: 7.14;
            object-fit: auto;
            object-position: center;
            width: 14px;
            fill: #000;
        }
        .item-quantity {
            color: #000;
            text-align: center;
            margin: auto 0;
            font: 500 16px Inter, sans-serif;
        }
        .grocery-footer {
            display: flex;
            width: 100%;
            flex-direction: column;
            font-size: 18px;
            color: #fff;
            font-weight: 400;
            white-space: nowrap;
            text-align: center;
            padding: 16px 16px 0;
        }
        .save-button {
            font-family: Inter, sans-serif;
            justify-content: center;
            align-items: center;
            border-radius: 999px;
            backdrop-filter: blur(10px);
            background-color: #000;
            padding: 17px 16px;
            color: white;
            font-size: 20px;
        }
        .grocery-item-input {
            flex-grow: 1;
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="section">
        <div class="header">Let’s Begin</div>
        <div class="subheader">Lorem ipsum dolor sit amet</div>
    </div>
    <div class="section">
        <div class="title">How many people?</div>
        <div class="content">
            <div class="icon-container" onclick="changeValue('people', -1)">
                <img loading="lazy" src="static/minus.svg" class="icon" />
            </div>
            <div class="number" id="people-value">1</div>
            <div class="icon-container" onclick="changeValue('people', 1)">
                <img loading="lazy" src="static/plus.svg" class="icon" />
            </div>
        </div>
    </div>
    <div class="section">
        <div class="title">What’s your budget?</div>
        <div class="content">
            <div class="icon-container" onclick="changeValue('budget', -1)">
                <img loading="lazy" src="static/minus.svg" class="icon" />
            </div>
            <div class="number" id="budget-value">1$</div>
            <div class="icon-container" onclick="changeValue('budget', 1)">
                <img loading="lazy" src="static/plus.svg" class="icon" />
            </div>
        </div>
    </div>
    <div class="section">
        <div class="title-container">
            <div class="title">Any known allergies?</div>
            <div class="manage-button" onclick="openDrawer('allergies-drawer')">Manage</div>
        </div>
        <div class="tags" id="allergies-tags">
            <div class="tag">Peanuts</div>
            <div class="tag">Wheat</div>
        </div>
    </div>
    <div class="section">
        <div class="title-container">
            <div class="title">Must have groceries</div>
            <div class="manage-button" onclick="openDrawer('must-have-drawer')">Manage</div>
        </div>
        <div class="tags-group" id="must-have-tags">
            <div class="tag-item">
                <div class="quantity">3</div>
                <div class="item">Bread</div>
            </div>
            <div class="tag-item">
                <div class="quantity">2</div>
                <div class="item">Milk</div>
            </div>
        </div>
    </div>
    <div class="section">
        <div class="title-container">
            <div class="title">Nice to have groceries</div>
            <div class="manage-button" onclick="openDrawer('nice-to-have-drawer')">Manage</div>
        </div>
        <div class="tags-group" id="nice-to-have-tags">
            <div class="tag-item">
                <div class="quantity">1</div>
                <div class="item">Nutella</div>
            </div>
            <div class="tag-item">
                <div class="quantity">1</div>
                <div class="item">Ice Cream</div>
            </div>
        </div>
    </div>
    <div class="continue-button" onclick="submitForm()">Continue</div>
</div>

<div id="allergies-drawer" class="drawer">
    <section class="allergy-container">
        <div class="allergy-content">
            <form class="allergy-card">
                <header class="allergy-card-header">
                    <h2 class="allergy-header-title">Any known allergies?</h2>
                    <div class="allergy-header-icon" onclick="closeDrawer('allergies-drawer')">
                        <img src="static/x.svg" alt="" />
                    </div>
                </header>
                <div class="allergy-item">
                    <label for="allergy-milk" class="allergy-name">Milk</label>
                    <button id="allergy-milk" class="allergy-action" type="button" onclick="toggleAllergy('Milk', this)">Add</button>
                </div>
                <div class="allergy-item">
                    <label for="allergy-soy" class="allergy-name">Soy</label>
                    <button id="allergy-soy" class="allergy-action" type="button" onclick="toggleAllergy('Soy', this)">Add</button>
                </div>
                <div class="allergy-item">
                    <label for="allergy-wheat" class="allergy-name">Wheat</label>
                    <button id="allergy-wheat" class="allergy-action remove" type="button" onclick="toggleAllergy('Wheat', this)">Remove</button>
                </div>
                <div class="allergy-item">
                    <label for="allergy-eggs" class="allergy-name">Eggs</label>
                    <button id="allergy-eggs" class="allergy-action" type="button" onclick="toggleAllergy('Eggs', this)">Add</button>
                </div>
                <div class="allergy-item">
                    <label for="allergy-peanuts" class="allergy-name">Peanuts</label>
                    <button id="allergy-peanuts" class="allergy-action remove" type="button" onclick="toggleAllergy('Peanuts', this)">Remove</button>
                </div>
                <div class="allergy-item">
                    <label for="allergy-fish" class="allergy-name">Fish</label>
                    <button id="allergy-fish" class="allergy-action" type="button" onclick="toggleAllergy('Fish', this)">Add</button>
                </div>
                <div class="allergy-submit-section">
                    <button class="allergy-submit-button" type="button" onclick="saveAllergies()">Save</button>
                </div>
            </form>
        </div>
    </section>
</div>

<div id="must-have-drawer" class="drawer">
    <section class="grocery-container">
        <header class="grocery-header">
            <h1 class="grocery-title">Must have groceries</h1>
            <div class="grocery-icon-wrapper" onclick="closeDrawer('must-have-drawer')">
                <img loading="lazy" src="static/x.svg" class="grocery-icon" alt="">
            </div>
        </header>
        <div class="grocery-item">
            <p class="grocery-item-name">Bread</p>
            <div class="grocery-item-controls">
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Bread', -1)">
                    <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                </div>
                <span class="item-quantity">3</span>
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Bread', 1)">
                    <img loading="lazy" src="static/plus.svg" class="icon" alt="Increase quantity">
                </div>
            </div>
        </div>
        <div class="grocery-item">
            <p class="grocery-item-name">Milk</p>
            <div class="grocery-item-controls">
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Milk', -1)">
                    <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                </div>
                <span class="item-quantity">2</span>
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Milk', 1)">
                    <img loading="lazy" src="static/plus.svg" class="icon" alt="Increase quantity">
                </div>
            </div>
        </div>
        <div class="grocery-item">
            <p class="grocery-item-name">Chicken Breast</p>
            <div class="grocery-item-controls">
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Chicken Breast', -1)">
                    <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                </div>
                <span class="item-quantity">0kg</span>
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Chicken Breast', 1)">
                    <img loading="lazy" src="static/plus.svg" class="icon" alt="Increase quantity">
                </div>
            </div>
        </div>
        <div class="grocery-item">
            <p class="grocery-item-name">Tea</p>
            <div class="grocery-item-controls">
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Tea', -1)">
                    <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                </div>
                <span class="item-quantity">0</span>
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Tea', 1)">
                    <img loading="lazy" src="static/plus.svg" class="icon" alt="Increase quantity">
                </div>
            </div>
        </div>
        <div class="grocery-item">
            <p class="grocery-item-name">Coffee Capsules</p>
            <div class="grocery-item-controls">
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Coffee Capsules', -1)">
                    <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                </div>
                <span class="item-quantity">0</span>
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Coffee Capsules', 1)">
                    <img loading="lazy" src="static/plus.svg" class="icon" alt="Increase quantity">
                </div>
            </div>
        </div>
        <div class="grocery-item">
            <p class="grocery-item-name">Tomatoes</p>
            <div class="grocery-item-controls">
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Tomatoes', -1)">
                    <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                </div>
                <span class="item-quantity">0</span>
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Tomatoes', 1)">
                    <img loading="lazy" src="static/plus.svg" class="icon" alt="Increase quantity">
                </div>
            </div>
        </div>
        <!-- Dynamic grocery items will be added here -->
        <div class="grocery-item add-item">
            <input type="text" id="must-have-input" class="grocery-item-input" placeholder="Add new item">
            <div class="control-icon-wrapper" onclick="addGroceryItem('must-have')">
                <img loading="lazy" src="static/plus.svg" class="control-icon" alt="Add item">
            </div>
        </div>
        <footer class="grocery-footer">
            <button class="save-button" type="button" onclick="saveGroceries('must-have')">Save</button>
        </footer>
    </section>
</div>

<div id="nice-to-have-drawer" class="drawer">
    <section class="grocery-container">
        <header class="grocery-header">
            <h1 class="grocery-title">Nice to have groceries</h1>
            <div class="grocery-icon-wrapper" onclick="closeDrawer('nice-to-have-drawer')">
                <img loading="lazy" src="static/x.svg" class="grocery-icon" alt="">
            </div>
        </header>
        <div class="grocery-item">
            <p class="grocery-item-name">Nutella</p>
            <div class="grocery-item-controls">
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Nutella', -1)">
                    <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                </div>
                <span class="item-quantity">1</span>
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Nutella', 1)">
                    <img loading="lazy" src="static/plus.svg" class="icon" alt="Increase quantity">
                </div>
            </div>
        </div>
        <div class="grocery-item">
            <p class="grocery-item-name">Ice Cream</p>
            <div class="grocery-item-controls">
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Ice Cream', -1)">
                    <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                </div>
                <span class="item-quantity">1</span>
                <div class="control-icon-wrapper" onclick="changeGroceryQuantity('Ice Cream', 1)">
                    <img loading="lazy" src="static/plus.svg" class="icon" alt="Increase quantity">
                </div>
            </div>
        </div>
        <!-- Dynamic grocery items will be added here -->
        <div class="grocery-item add-item">
            <input type="text" id="nice-to-have-input" class="grocery-item-input" placeholder="Add new item">
            <div class="control-icon-wrapper" onclick="addGroceryItem('nice-to-have')">
                <img loading="lazy" src="static/plus.svg" class="control-icon" alt="Add item">
            </div>
        </div>
        <footer class="grocery-footer">
            <button class="save-button" type="button" onclick="saveGroceries('nice-to-have')">Save</button>
        </footer>
    </section>
</div>

<script>
    function changeValue(type, delta) {
        const valueElement = document.getElementById(`${type}-value`);
        let currentValue = parseInt(valueElement.textContent.replace('$', ''));
        currentValue = Math.max(1, currentValue + delta);
        valueElement.textContent = type === 'budget' ? `${currentValue}$` : currentValue;
    }

    function openDrawer(drawerId) {
        const drawer = document.getElementById(drawerId);
        drawer.classList.add('open');
    }

    function closeDrawer(drawerId) {
        const drawer = document.getElementById(drawerId);
        drawer.classList.remove('open');
    }

    function toggleAllergy(allergy, button) {
        const isRemoving = button.textContent === 'Remove';
        button.textContent = isRemoving ? 'Add' : 'Remove';
        button.classList.toggle('remove', !isRemoving);
    }

    function saveAllergies() {
        const tagsContainer = document.getElementById('allergies-tags');
        tagsContainer.innerHTML = '';
        const buttons = document.querySelectorAll('.allergy-action');
        buttons.forEach(button => {
            if (button.textContent === 'Remove') {
                const allergy = button.previousElementSibling.textContent;
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.textContent = allergy;
                tagsContainer.appendChild(tag);
            }
        });
        closeDrawer('allergies-drawer');
    }

    function changeGroceryQuantity(item, delta) {
        const groceryItems = document.querySelectorAll('.grocery-item');
        groceryItems.forEach(groceryItem => {
            const itemNameElement = groceryItem.querySelector('.grocery-item-name');
            if (itemNameElement && itemNameElement.textContent === item) {
                const quantityElement = groceryItem.querySelector('.item-quantity');
                if (quantityElement) {
                    let currentQuantity = parseInt(quantityElement.textContent.replace('kg', '')) || 0;
                    currentQuantity = Math.max(0, currentQuantity + delta);
                    quantityElement.textContent = currentQuantity + (item === 'Chicken Breast' ? 'kg' : '');
                }
            }
        });
    }

    function addGroceryItem(type) {
        const inputId = `${type}-input`;
        const inputElement = document.getElementById(inputId);
        const newItem = inputElement.value.trim();

        if (newItem === "") {
            return; // Do nothing if the input is empty
        }

        const drawer = document.getElementById(`${type}-drawer`);
        const addItemElement = drawer.querySelector('.add-item');

        if (addItemElement) {
            const itemContainer = document.createElement('div');
            itemContainer.className = 'grocery-item';
            itemContainer.innerHTML = `
                <p class="grocery-item-name">${newItem}</p>
                <div class="grocery-item-controls">
                    <div class="control-icon-wrapper" onclick="changeGroceryQuantity('${newItem}', -1)">
                        <img loading="lazy" src="static/minus.svg" class="control-icon" alt="Decrease quantity">
                    </div>
                    <span class="item-quantity">1</span>
                    <div class="control-icon-wrapper" onclick="changeGroceryQuantity('${newItem}', 1)">
                        <img loading="lazy" src="static/plus.svg" class="control-icon" alt="Increase quantity">
                    </div>
                </div>
            `;

            // Append the new item before the addItemElement
            drawer.querySelector('section').insertBefore(itemContainer, addItemElement);
        }

        inputElement.value = ""; // Clear the input field
    }

    function saveGroceries(type) {
        const tagsContainer = document.getElementById(`${type}-tags`);
        tagsContainer.innerHTML = '';
        const drawer = document.getElementById(`${type}-drawer`);
        const groceryItems = drawer.querySelectorAll('.grocery-item');

        let items = [];

        groceryItems.forEach(groceryItem => {
            const itemNameElement = groceryItem.querySelector('.grocery-item-name');
            const quantityElement = groceryItem.querySelector('.item-quantity');

            if (itemNameElement && quantityElement) {
                const itemName = itemNameElement.textContent;
                const quantity = quantityElement.textContent;

                if (parseInt(quantity) > 0) {
                    items.push({
                        name: itemName,
                        quantity: quantity
                    });
                }
            }
        });

        const firstFourItems = items.slice(0, 4);
        const remainingItems = items.slice(4);

        firstFourItems.forEach(item => {
            const tagItem = document.createElement('div');
            tagItem.className = 'tag-item';
            tagItem.innerHTML = `<div class="quantity">${item.quantity}</div><div class="item">${item.name}</div>`;
            tagsContainer.appendChild(tagItem);
        });

        if (remainingItems.length > 0) {
            const moreItemsTag = document.createElement('div');
            moreItemsTag.className = 'tag';
            moreItemsTag.textContent = `+${remainingItems.length} more`;
            moreItemsTag.style.cursor = 'pointer';
            moreItemsTag.onclick = () => {
                tagsContainer.innerHTML = ''; // Clear the container
                items.forEach(item => {
                    const tagItem = document.createElement('div');
                    tagItem.className = 'tag-item';
                    tagItem.innerHTML = `<div class="quantity">${item.quantity}</div><div class="item">${item.name}</div>`;
                    tagsContainer.appendChild(tagItem);
                });
            };
            tagsContainer.appendChild(moreItemsTag);
        }

        closeDrawer(`${type}-drawer`);
    }

    function submitForm() {
        const people = document.getElementById('people-value').textContent;
        const budget = document.getElementById('budget-value').textContent.replace('$', '');

        const allergies = Array.from(document.querySelectorAll('#allergies-tags .tag')).map(tag => tag.textContent);

        const mustHaveItems = {};
        const niceToHaveItems = {};

        // Collect items from must-have drawer
        const mustHaveDrawerItems = Array.from(document.querySelectorAll('#must-have-drawer .grocery-item'));
        mustHaveDrawerItems.forEach(item => {
            const itemName = item.querySelector('.grocery-item-name')?.textContent;
            const itemQuantity = item.querySelector('.item-quantity')?.textContent;
            if (itemName && itemQuantity) {
                mustHaveItems[itemName] = itemQuantity;
            }
        });

        // Collect items from must-have tags
        const mustHaveTagsItems = Array.from(document.querySelectorAll('#must-have-tags .tag-item'));
        mustHaveTagsItems.forEach(tagItem => {
            const itemName = tagItem.querySelector('.item')?.textContent;
            const itemQuantity = tagItem.querySelector('.quantity')?.textContent;
            if (itemName && itemQuantity) {
                mustHaveItems[itemName] = itemQuantity;
            }
        });

        // Collect items from nice-to-have drawer
        const niceToHaveDrawerItems = Array.from(document.querySelectorAll('#nice-to-have-drawer .grocery-item'));
        niceToHaveDrawerItems.forEach(item => {
            const itemName = item.querySelector('.grocery-item-name')?.textContent;
            const itemQuantity = item.querySelector('.item-quantity')?.textContent;
            if (itemName && itemQuantity) {
                niceToHaveItems[itemName] = itemQuantity;
            }
        });

        // Collect items from nice-to-have tags
        const niceToHaveTagsItems = Array.from(document.querySelectorAll('#nice-to-have-tags .tag-item'));
        niceToHaveTagsItems.forEach(tagItem => {
            const itemName = tagItem.querySelector('.item')?.textContent;
            const itemQuantity = tagItem.querySelector('.quantity')?.textContent;
            if (itemName && itemQuantity) {
                niceToHaveItems[itemName] = itemQuantity;
            }
        });

        const data = {
            family_size: people,
            budget: budget,
            allergies: allergies,
            must_have: mustHaveItems,
            nice_to_have: niceToHaveItems
        };

        console.log('Data to be sent:', data);

        fetch('{{ url_for('setup') }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(response => {
            if (response.redirected) {
                window.location.href = response.url;
            } else {
                response.json().then(data => {
                    console.error('Form submission failed:', data);
                });
            }
        }).catch(error => console.error('Error:', error));
    }
</script>
</body>
</html>
